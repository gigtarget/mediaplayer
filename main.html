<!--
  iOS26 Glass Music Player – single‑file HTML/CSS/JS (editable + export to video)
  • Edit fields: Title, Artist, Duration (mm:ss), Cover image upload
  • Aspect presets: 16:9, 9:16, 1:1 (top‑left)
  • Light/Dark toggle + Accent swatches
  • Render button exports a clean video of the player “playing” for the full duration
    - WebM (fast, built‑in) via MediaRecorder on element captureStream()
    - MP4 (beta, slower) via ffmpeg.wasm transcoding the recorded WebM
  • Toolbars/controls auto‑hide during render. Only the player is captured.
-->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>iOS26 Glass Music Player – Editable + Export</title>
  <style>
    :root{
      --bg1:#0b0f1a; --bg2:#151a29; --glass:rgba(255,255,255,.08); --glass-strong:rgba(255,255,255,.14);
      --stroke:rgba(255,255,255,.22); --text:#edf2ff; --muted:#a6b0c2; --accent:#6aa8ff; --accent-2:#b387ff;
      --shadow:0 20px 50px rgba(0,0,0,.45); --radius-xl:28px; --radius-lg:20px; --radius-md:14px;
    }
    .light{ --bg1:#f0f4ff; --bg2:#e8ecfb; --glass:rgba(255,255,255,.6); --glass-strong:rgba(255,255,255,.85);
      --stroke:rgba(10,20,40,.12); --text:#0b1020; --muted:#46506a; --shadow:0 12px 40px rgba(30,40,80,.18); }
    *{box-sizing:border-box} html,body{height:100%}
    body{ margin:0; font-family: ui-sans-serif,system-ui,"SF Pro Text","Inter",Segoe UI,Roboto,Helvetica,Arial;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(255,255,255,.08), transparent 60%),
                  radial-gradient(900px 700px at 90% 80%, rgba(255,255,255,.06), transparent 60%),
                  linear-gradient(135deg,var(--bg1),var(--bg2)); color:var(--text);
      display:grid; grid-template-rows:auto 1fr; gap:14px; padding:16px; }

    /* CONTROL PANEL (not recorded) */
    .panel{ display:flex; flex-wrap:wrap; gap:10px; align-items:end; padding:10px 12px; border:1px solid var(--stroke);
      background:linear-gradient(180deg,rgba(255,255,255,.14),rgba(255,255,255,.08)); border-radius:16px; }
    .panel label{ font-size:12px; display:flex; flex-direction:column; gap:6px; color:var(--muted) }
    .panel input[type="text"], .panel input[type="file"]{ padding:10px 12px; min-width:220px; border-radius:10px; border:1px solid var(--stroke);
      background:rgba(255,255,255,.06); color:var(--text) }
    .panel input[type="text"]::placeholder{ color:var(--muted) }
    .panel .btn{ padding:10px 14px; border-radius:12px; border:1px solid var(--stroke);
      background:linear-gradient(180deg,rgba(255,255,255,.18),rgba(255,255,255,.1)); color:var(--text); cursor:pointer }
    .panel .btn.primary{ background:linear-gradient(180deg,var(--accent),var(--accent-2)); border:none }
    .panel .info{ font-size:12px; color:var(--muted); margin-left:auto }

    /* RECORDING STAGE */
    #stage{ position:relative; width:min(92vw, 1280px); aspect-ratio:16/9; border-radius:34px; overflow:hidden; margin:0 auto; }
    #stage.frame-916{ aspect-ratio:9/16; width:min(52vw, 720px); }
    #stage.frame-11{ aspect-ratio:1/1; width:min(60vw, 900px); }

    .bg-orbs{position:absolute; inset:0; pointer-events:none}
    .bg-orbs:before,.bg-orbs:after{ content:""; position:absolute; filter:blur(80px); opacity:.55; mix-blend:screen; border-radius:50% }
    .bg-orbs:before{ width:42%; height:42%; left:-8%; top:-10%; background:radial-gradient(circle at 30% 30%, #6aa8ff, transparent 60%) }
    .bg-orbs:after{ width:46%; height:46%; right:-6%; bottom:-12%; background:radial-gradient(circle at 70% 70%, #b387ff, transparent 60%) }

    .glass-wrap{ position:absolute; inset:0; padding:28px; display:grid }

    .player{ margin:auto; display:grid; grid-template-columns:340px 1fr; gap:28px; align-items:center;
      background:linear-gradient(180deg,var(--glass-strong),var(--glass)); backdrop-filter: blur(22px) saturate(1.25);
      -webkit-backdrop-filter: blur(22px) saturate(1.25); border:1px solid var(--stroke); border-radius:var(--radius-xl);
      box-shadow:var(--shadow); padding:24px; width:min(100%,1100px); outline:1px solid rgba(255,255,255,.055);
    }
    .portrait .player{ grid-template-columns:1fr }

    .cover{ position:relative; aspect-ratio:1/1; border-radius:24px; overflow:hidden; background:linear-gradient(135deg,#0d121f,#141b2d); border:1px solid var(--stroke); display:grid; place-items:center }
    .vinyl{ width:85%; height:85%; border-radius:50%; background:
        radial-gradient(circle at 50% 50%, #222 0 38%, transparent 38.2%),
        radial-gradient(circle at 50% 50%, #111 0 40%, #0b0f18 41% 64%, #05070c 65% 100%),
        repeating-conic-gradient(from 0deg, rgba(255,255,255,.06) 0 2deg, transparent 2deg 4deg);
      box-shadow: inset 0 0 0 6px rgba(0,0,0,.4), inset 0 0 60px rgba(0,0,0,.55);
      position:relative; display:grid; place-items:center; animation:spin 18s linear infinite; animation-play-state:paused }
    .cover.has-image .vinyl{ width:100%; height:100%; border-radius:0; background-size:cover; background-position:center; box-shadow:none; animation-play-state:paused }
    .playing .vinyl{ animation-play-state:running }
    .label{ width:32%; height:32%; border-radius:50%; background: radial-gradient(circle at 40% 30%, #fff 0, #ddd 40%, #bbb 62%, #888 100%);
      box-shadow: inset 0 0 12px rgba(0,0,0,.5); display:grid; place-items:center; font-weight:700; color:#111; font-size:12px; text-transform:uppercase; letter-spacing:.06em }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    .meta h1{ margin:0 0 6px; font-size:28px; letter-spacing:.2px }
    .meta h2{ margin:0 0 18px; font-size:16px; font-weight:500; color:var(--muted) }
    .badges{ display:flex; gap:10px; margin-bottom:18px; flex-wrap:wrap }
    .badge{ font-size:11px; padding:8px 10px; border-radius:999px; border:1px solid var(--stroke); background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06)); text-transform:uppercase; letter-spacing:.12em }

    .wave{ height:78px; border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.06)); border:1px solid var(--stroke); overflow:hidden; position:relative; margin-bottom:16px }
    .wave-bars{ position:absolute; inset:0; display:grid; grid-template-columns: repeat(120, 1fr); gap:2px; align-items:end; padding:10px }
    .wave-bars span{ display:block; border-radius:6px 6px 0 0; background: linear-gradient(180deg, var(--accent), var(--accent-2)); opacity:.85; height:40% }

    .timeline{ display:grid; grid-template-columns:60px 1fr 60px; align-items:center; gap:12px }
    .progress{ height:8px; border-radius:999px; background: rgba(255,255,255,.14); border:1px solid var(--stroke); position:relative; overflow:hidden }
    .progress .fill{ position:absolute; inset:0; width:0%; background:linear-gradient(90deg, var(--accent), var(--accent-2)); box-shadow: 0 0 24px rgba(100,150,255,.35) inset }
    .time{ font-size:12px; color:var(--muted); text-align:center }

    .controls{ display:flex; align-items:center; gap:12px; margin-top:18px }
    .btn{ display:grid; place-items:center; width:44px; height:44px; border-radius:12px; border:1px solid var(--stroke); background:linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.08)); cursor:pointer; transition:.25s transform }
    .btn:active{ transform:translateY(1px) scale(.98) }
    .btn.primary{ width:56px; height:56px; background:linear-gradient(180deg, var(--accent), var(--accent-2)); border:none; box-shadow:0 8px 28px rgba(106,168,255,.35) }
    .spacer{ flex:1 }
    .volume{ display:flex; align-items:center; gap:10px }
    .slider{ width:120px; height:8px; border-radius:999px; background: rgba(255,255,255,.14); border:1px solid var(--stroke); position:relative }
    .slider .fill{ position:absolute; inset:0; width:65%; background: linear-gradient(90deg, var(--accent), var(--accent-2)) }

    /* Toolbars (not recorded) */
    .toolbar{ position:absolute; top:18px; left:18px; display:flex; gap:10px; z-index:5 }
    .toolbar .chip{ font-size:12px; padding:10px 12px; border-radius:999px; border:1px solid var(--stroke); background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.1)); cursor:pointer }
    .toolbar .swatch{ width:26px; height:26px; border-radius:999px; border:1px solid var(--stroke); cursor:pointer; box-shadow: inset 0 0 0 2px rgba(255,255,255,.25) }

    /* Hide non‑stage UI during export */
    body.exporting .panel, body.exporting .toolbar{ display:none !important }

    .credits{ position:absolute; bottom:18px; left:18px; font-size:11px; color:var(--muted); opacity:.85 }
  </style>
</head>
<body>
  <!-- CONTROL PANEL (user edits) -->
  <div class="panel" id="panel">
    <label>Song Title
      <input id="inTitle" type="text" placeholder="Song Title" value="Song Title – Lounge Edit" />
    </label>
    <label>Artist Name
      <input id="inArtist" type="text" placeholder="Artist Name" value="Artist Name • House of Tyche" />
    </label>
    <label>Total Duration (mm:ss)
      <input id="inDur" type="text" placeholder="03:28" value="03:28" />
    </label>
    <label>Cover Image
      <input id="inCover" type="file" accept="image/*" />
    </label>
    <button class="btn" onclick="setAspect('frame-169')">16:9</button>
    <button class="btn" onclick="setAspect('frame-916')">9:16</button>
    <button class="btn" onclick="setAspect('frame-11')">1:1</button>
    <button class="btn" onclick="toggleTheme()">Light/Dark</button>
    <button class="btn" style="--accent:#6aa8ff;--accent-2:#b387ff;background:linear-gradient(135deg,#6aa8ff,#b387ff)" onclick="setAccent('#6aa8ff','#b387ff')">A</button>
    <button class="btn" style="--accent:#ff9d6c;--accent-2:#ffd66c;background:linear-gradient(135deg,#ff9d6c,#ffd66c)" onclick="setAccent('#ff9d6c','#ffd66c')">A</button>
    <div class="info">Render →
      <button class="btn primary" onclick="renderVideo('webm')">Video (WebM)</button>
      <button class="btn" onclick="renderVideo('mp4')">Video (MP4 β)</button>
    </div>
  </div>

  <!-- RECORDING STAGE (captured to video) -->
  <div id="stage" class="frame frame-169">
    <div class="bg-orbs"></div>
    <div class="glass-wrap">
      <div class="player" id="player">
        <div class="cover" id="cover">
          <div class="vinyl" id="vinyl">
            <div class="label">SIDE • A</div>
          </div>
        </div>
        <div class="right">
          <div class="meta">
            <h1 id="title" contenteditable>Song Title – Lounge Edit</h1>
            <h2 id="artist" contenteditable>Artist Name • House of Tyche</h2>
            <div class="badges">
              <div class="badge">Hi‑Res</div>
              <div class="badge">Stereo</div>
              <div class="badge">24‑bit</div>
            </div>
          </div>
          <div class="wave" aria-label="waveform">
            <div class="wave-bars" id="bars"></div>
          </div>
          <div class="timeline">
            <div class="time" id="tcur">0:00</div>
            <div class="progress"><div class="fill" id="pfill"></div></div>
            <div class="time" id="tend">3:28</div>
          </div>
          <div class="controls">
            <button class="btn" title="Previous" onclick="nudge(-1)">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M7 6v12M19 7l-8 5 8 5V7z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button id="play" class="btn primary" title="Pause" onclick="togglePlay()">
              <svg id="playicon" width="22" height="22" viewBox="0 0 24 24" fill="none">
                <!-- Pause icon by default (since visuals are simulated) -->
                <rect x="6" y="5" width="4" height="14" rx="1" fill="#fff"/>
                <rect x="14" y="5" width="4" height="14" rx="1" fill="#fff"/>
              </svg>
            </button>
            <button class="btn" title="Next" onclick="nudge(1)">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M17 6v12M5 7l8 5-8 5V7z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <div class="spacer"></div>
            <button class="btn" title="Shuffle">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M17 3h4v4M3 7h6a6 6 0 006 6h6M21 17v4h-4M3 17h6a6 6 0 016-6h6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="btn" title="Repeat">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M17 1l3 3-3 3M7 23l-3-3 3-3M4 6a8 8 0 0114-1M20 18a8 8 0 01-14 1" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <div class="volume">
              <svg width="22" height="22" viewBox="0 0 24 24" fill="none"><path d="M4 10h4l5-4v12l-5-4H4zM17 9a3 3 0 010 6M19 7a5 5 0 010 10" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
              <div class="slider"><div class="fill"></div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- On‑stage toolbar (hidden during export) -->
    <div class="toolbar">
      <div class="chip" onclick="setAspect('frame-169')">16:9</div>
      <div class="chip" onclick="setAspect('frame-916')">9:16</div>
      <div class="chip" onclick="setAspect('frame-11')">1:1</div>
      <div class="chip" onclick="toggleTheme()">Light/Dark</div>
      <div class="swatch" style="background:linear-gradient(135deg,#6aa8ff,#b387ff)" onclick="setAccent('#6aa8ff','#b387ff')"></div>
      <div class="swatch" style="background:linear-gradient(135deg,#ff9d6c,#ffd66c)" onclick="setAccent('#ff9d6c','#ffd66c')"></div>
      <div class="swatch" style="background:linear-gradient(135deg,#7bd389,#2bd2ff)" onclick="setAccent('#7bd389','#2bd2ff')"></div>
    </div>

    <div class="credits">iOS26 Glass Music Player – visuals for video editors</div>
  </div>

  <script>
    // ---------- Helpers ----------
    const qs = sel => document.querySelector(sel);
    const qsa = sel => Array.from(document.querySelectorAll(sel));
    const stage = qs('#stage');
    const player = qs('#player');
    const body = document.body;

    function setAspect(cls){ stage.className = 'frame ' + cls; if(cls==='frame-916') stage.classList.add('portrait'); else stage.classList.remove('portrait'); }
    function toggleTheme(){ body.classList.toggle('light'); }
    function setAccent(a,b){ document.documentElement.style.setProperty('--accent', a); document.documentElement.style.setProperty('--accent-2', b); }

    // ---------- Editable fields sync ----------
    const inTitle = qs('#inTitle');
    const inArtist = qs('#inArtist');
    const inDur = qs('#inDur');
    const inCover = qs('#inCover');
    const elTitle = qs('#title');
    const elArtist = qs('#artist');
    const elTcur = qs('#tcur');
    const elTend = qs('#tend');
    const elFill = qs('#pfill');
    const cover = qs('#cover');
    const vinyl = qs('#vinyl');

    inTitle.addEventListener('input', ()=> elTitle.textContent = inTitle.value || '');
    inArtist.addEventListener('input', ()=> elArtist.textContent = inArtist.value || '');
    inDur.addEventListener('input', ()=> elTend.textContent = normTime(inDur.value));

    inCover.addEventListener('change', e => {
      const f = e.target.files?.[0];
      if(!f) return;
      const url = URL.createObjectURL(f);
      cover.classList.add('has-image');
      vinyl.style.backgroundImage = `url('${url}')`;
      // Add subtle zoom animation to still image
      vinyl.animate([{transform:'scale(1)'},{transform:'scale(1.02)'}],{duration:4000,direction:'alternate',iterations:Infinity});
    });

    function normTime(s){
      const m = /^\s*(\d{1,2})[:._-]?(\d{0,2})\s*$/.exec(s||'');
      if(!m) return '03:28';
      const mm = Math.max(0, parseInt(m[1]||'0',10));
      const ss = Math.max(0, parseInt(m[2]||'0',10));
      return `${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
    }

    // ---------- Fake playback engine (drives progress + timecode) ----------
    let playing = false, startTs = 0, totalMs = 208000, rafId = null;

    function durationMs(){
      const [mm, ss] = (elTend.textContent||'00:00').split(':').map(x=>parseInt(x,10)||0);
      return (mm*60+ss)*1000;
    }

    function togglePlay(force){
      playing = force ?? !playing;
      player.classList.toggle('playing', playing);
      if(playing){
        startTs = performance.now() - progress()*durationMs();
        tick();
      } else {
        cancelAnimationFrame(rafId);
      }
    }

    function progress(){
      const t = performance.now() - startTs; const d = durationMs();
      return Math.min(1, Math.max(0, t/d));
    }

    function fmt(ms){
      const s = Math.floor(ms/1000); const m = Math.floor(s/60); const r = s%60;
      return `${String(m).padStart(1,'0')}:${String(r).padStart(2,'0')}`;
    }

    function tick(){
      const pr = progress();
      elFill.style.width = (pr*100).toFixed(4)+'%';
      elTcur.textContent = fmt(pr*durationMs());
      rafId = requestAnimationFrame(() => {
        if(pr>=1){ playing=false; player.classList.remove('playing'); cancelAnimationFrame(rafId); return; }
        tick();
      });
    }

    // Nudge just jumps the progress a little for demo
    function nudge(dir){
      const d = durationMs();
      const cur = progress()*d + dir*5000; // 5s steps
      startTs = performance.now() - Math.max(0, Math.min(d, cur));
      if(!playing) tick();
    }

    // ---------- Waveform scaffolding ----------
    (function buildBars(){
      const bars = qs('#bars');
      for(let i=0;i<120;i++){
        const s = document.createElement('span');
        const h = 20 + Math.random()*58 + (i%8)*2; // pleasing variation
        s.style.height = h+'%';
        bars.appendChild(s);
      }
      // subtle breathing
      setInterval(()=>{
        qsa('#bars span').forEach((el,idx)=>{
          const h = parseFloat(el.style.height);
          const n = Math.max(12, Math.min(90, h + (Math.random()*8-4)));
          el.style.height = n+'%';
        })
      }, 500);
    })();

    // ---------- Initial values ----------
    elTend.textContent = inDur.value;
    togglePlay(true); // start spinning/animating on load

    // ---------- Rendering to Video ----------
    async function renderVideo(fmt){
      try{
        body.classList.add('exporting');
        await new Promise(r=>setTimeout(r,150)); // let layout settle

        // Ensure we start from 0 for the render and play through to end
        elTcur.textContent = '0:00';
        elFill.style.width = '0%';
        startTs = performance.now();
        togglePlay(true);

        const fps = 60; // target
        const stream = stage.captureStream(fps);
        const chunks = [];
        const mimeWebm = MediaRecorder.isTypeSupported('video/webm;codecs=vp9') ? 'video/webm;codecs=vp9' : 'video/webm';
        const rec = new MediaRecorder(stream, { mimeType: mimeWebm, videoBitsPerSecond: 8_000_000 });
        rec.ondataavailable = e => e.data && chunks.push(e.data);
        const done = new Promise(res=>rec.onstop = res);
        rec.start(100); // collect in 100ms chunks

        // Stop when duration elapses
        await new Promise(r=>setTimeout(r, durationMs()));
        rec.stop();
        await done;
        togglePlay(false);

        const webmBlob = new Blob(chunks, { type: mimeWebm });

        if(fmt === 'webm'){
          saveBlob(webmBlob, safeFileName(inTitle.value || 'song') + '.webm');
        } else if(fmt === 'mp4'){
          // Transcode using ffmpeg.wasm (beta: heavy on CPU/RAM)
          const mp4Blob = await transcodeWebMtoMP4(webmBlob);
          saveBlob(mp4Blob, safeFileName(inTitle.value || 'song') + '.mp4');
        }
      } catch(err){
        console.error(err);
        alert('Render failed: ' + err.message);
      } finally {
        body.classList.remove('exporting');
      }
    }

    function saveBlob(blob, filename){
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(a.href), 2000);
    }

    function safeFileName(s){
      return (s||'output').replace(/[^\w\-\s\u00A0-\uFFFF]/g,'').trim().replace(/\s+/g,'_');
    }

    // ---------- ffmpeg.wasm loader/transcode ----------
    let ffmpegReady = false, ffmpegRef = null;
    async function ensureFFmpeg(){
      if(ffmpegReady) return ffmpegRef;
      // Load scripts lazily
      await import('https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js');
      const { createFFmpeg, fetchFile } = FFmpeg;
      const ffmpeg = createFFmpeg({ log: true, corePath: 'https://unpkg.com/@ffmpeg/core@0.12.6/dist/ffmpeg-core.js' });
      await ffmpeg.load();
      ffmpeg.fetchFile = fetchFile; // expose helper
      ffmpegReady = true; ffmpegRef = ffmpeg; return ffmpeg;
    }

    async function transcodeWebMtoMP4(webmBlob){
      const ffmpeg = await ensureFFmpeg();
      const webmData = await ffmpeg.fetchFile(webmBlob);
      const inName = 'input.webm', outName = 'output.mp4';
      ffmpeg.FS('writeFile', inName, webmData);
      // Simple transcode to H.264 + AAC (fragmented MP4 for fast start)
      await ffmpeg.run('-i', inName, '-c:v', 'libx264', '-pix_fmt', 'yuv420p', '-preset', 'veryfast', '-crf', '20', '-c:a', 'aac', '-b:a', '192k', '-movflags', '+faststart', outName);
      const data = ffmpeg.FS('readFile', outName);
      return new Blob([data.buffer], { type: 'video/mp4' });
    }
  </script>
</body>
</html>
